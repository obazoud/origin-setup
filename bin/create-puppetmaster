#!/usr/bin/bash

# ----------------------------------------------------------------------------
# Main process
# ----------------------------------------------------------------------------
# AWS credentials settings
#
#AWSCRED


HOSTNAME=puppet.infra.lamourine.org
BASE_OS=fedora19
EC2_TYPE=m1.small

# Must contain a manifests and modules sub directory.
# manifests will contain site.pp  and nodes subdir.  Puppet node specs will
# be placed in manifests/nodes/<hostname>.pp
#
SITE_REPO=https://github.com/markllama/origin-puppet.git

ssh-keygen -R ${HOSTNAME}

# 1) create an EC2 instance to hold the puppet master service
thor origin:baseinstance puppet --baseos ${BASE_OS} --type ${EC2_TYPE} \
    --securitygroup default puppetmaster \
    --hostname ${HOSTNAME} --elasticip \
    ${VERBOSE}

thor ec2:instance tag --name puppet --tag purpose --value puppetinstall
thor remote:available ${HOSTNAME} ${VERBOSE}

# make ordinary universal OpenShift Origin tweaks before specializing the host
thor origin:prepare ${HOSTNAME} ${VERBOSE}

# 
thor origin:puppetmaster ${HOSTNAME} --siterepo ${SITE_REPO} ${VERBOSE}
    
